"use strict";(self.webpackChunkyokoy_movies_db=self.webpackChunkyokoy_movies_db||[]).push([[869],{4869:($,f,l)=>{l.r(f),l.d(f,{MoviesModule:()=>Y});var p=l(4755),v=l(9289),r=l(5030),h=l(4469),d=l(9064),e=l(9523),u=l(4004),c=l(2340),y=l(3144);let _=(()=>{class o{constructor(t){this.http=t}getMovies(t,i){let s=`${c.N.domain}${c.N.api.movies}`;return s=this._getFilterAppliedUrl(i,s),this.http.get(s).pipe((0,u.U)(a=>a))}getMovieById(t){return this.http.get(`${c.N.domain}${c.N.api.movies}/${t}`).pipe((0,u.U)(i=>i))}create(t){return this.http.post(`${c.N.domain}${c.N.api.movies}`,t).pipe((0,u.U)(i=>i))}update(t,i){return this.http.patch(`${c.N.domain}${c.N.api.movies}/${t}`,i).pipe((0,u.U)(s=>s))}delete(t){return this.http.delete(`${c.N.domain}${c.N.api.movies}/${t}`).pipe((0,u.U)(i=>i))}_getFilterAppliedUrl(t,i){return Object.entries(t).filter(([s,a])=>!!a).forEach(([s,a],m)=>{const g=0===m?"?":"&";switch(s){case"title":i+=`${g}title_like=${a}`;break;case"year":i+=`${g}year=${a}`;break;case"rate":i+=`${g}rate=${a}`}}),i}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(y.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var C=l(609),M=l(6821);function b(o,n){1&o&&(e.TgZ(0,"h2"),e._uU(1,"Add new movie"),e.qZA())}function T(o,n){if(1&o&&(e.TgZ(0,"h2"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("Edit movie with id = ",t.data.movie.id,"")}}function A(o,n){1&o&&(e.TgZ(0,"label"),e._uU(1," * Title is required "),e.qZA())}function U(o,n){if(1&o&&(e.TgZ(0,"div",11),e.YNc(1,A,2,0,"label",1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.movieForm.controls.title.hasError("required"))}}function F(o,n){if(1&o&&(e.TgZ(0,"option",12),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.name),e.xp6(1),e.Oqu(t.name)}}function I(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.delete())}),e._uU(1,"Delete!"),e.qZA()}}let N=(()=>{class o{constructor(t,i,s,a,m){this.data=t,this.moviesService=i,this.actorsService=s,this.dialogRef=a,this.errorService=m,this.actors=[],this.submitted=!1,this.pageIndex=1,this.movieForm=new r.cw({title:new r.NI("",[r.kI.required]),year:new r.NI(0,[]),actors:new r.NI([],[])}),this.movieForm.patchValue({...this.data.movie})}ngOnInit(){this._getActors()}submit(){this.submitted=!0,this.movieForm.invalid?this.movieForm.markAllAsTouched():this.data.movie?.id?this._updateMovie():this._createMovie()}delete(){this.moviesService.delete(this.data.movie.id).subscribe(t=>{this.dialogRef.close()},t=>{this.errorService.handle({friendlyMessage:"Unable to delete movie, please try again later!",message:t.message,priority:d.p.CRITICAL})})}_createMovie(){this.moviesService.create(this.movieForm.value).subscribe(t=>{this.dialogRef.close()},t=>{this.errorService.handle({friendlyMessage:"Unable to get create movie, please try again later!",message:t.message,priority:d.p.MAJOR})})}_updateMovie(){this.moviesService.update(this.data.movie.id.toString(),this.movieForm.value).subscribe(t=>{this.dialogRef.close()},t=>{this.errorService.handle({friendlyMessage:"Unable to get update movie, please try again later!",message:t.message,priority:d.p.MAJOR})})}_getActors(){this.actorsService.getActors(this.pageIndex).subscribe(t=>{this.actors=t},t=>{this.errorService.handle({friendlyMessage:"Unable to get actors, please try again later!",message:t.message,priority:d.p.CRITICAL})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(h.WI),e.Y36(_),e.Y36(C.A),e.Y36(h.so),e.Y36(M.q))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-movie-dialog"]],decls:17,vars:10,consts:[[1,"modal-content"],[4,"ngIf"],[3,"formGroup"],["placeholder","title","type","text","formControlName","title"],["class","text-error",4,"ngIf"],["placeholder","year","type","number","formControlName","year"],["multiple","","placeholder","actors","formControlName","actors"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"submit",3,"click"],["class","submit",3,"click",4,"ngIf"],[1,"text-error"],[3,"value"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,b,2,0,"h2",1),e.YNc(2,T,2,1,"h2",1),e.TgZ(3,"form",2)(4,"div"),e._UZ(5,"input",3),e.YNc(6,U,2,1,"div",4),e.qZA(),e.TgZ(7,"div"),e._UZ(8,"input",5),e.qZA(),e.TgZ(9,"div")(10,"select",6)(11,"option",7),e._uU(12,"Select actors"),e.qZA(),e.YNc(13,F,2,2,"option",8),e.qZA()(),e.TgZ(14,"button",9),e.NdJ("click",function(){return i.submit()}),e._uU(15,"Save!"),e.qZA(),e.YNc(16,I,2,0,"button",10),e.qZA()()),2&t){let s,a;e.xp6(1),e.Q6J("ngIf",!(null!=i.data.movie&&i.data.movie.id)),e.xp6(1),e.Q6J("ngIf",null==i.data.movie?null:i.data.movie.id),e.xp6(1),e.Q6J("formGroup",i.movieForm),e.xp6(2),e.ekj("error",i.submitted&&(null==(s=i.movieForm.get("title"))?null:s.errors)),e.xp6(1),e.Q6J("ngIf",i.movieForm.controls.title.invalid&&(i.movieForm.controls.title.dirty||i.movieForm.controls.title.touched)),e.xp6(2),e.ekj("error",i.submitted&&(null==(a=i.movieForm.get("year"))?null:a.errors)),e.xp6(5),e.Q6J("ngForOf",i.actors),e.xp6(3),e.Q6J("ngIf",null==i.data.movie?null:i.data.movie.id)}},dependencies:[p.sg,p.O5,r._Y,r.YN,r.Kr,r.Fj,r.wV,r.K7,r.JJ,r.JL,r.sg,r.u],styles:["form[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:12px;display:flex;flex-direction:column}"]}),o})();const x={};var S=l(8372),Z=l(888);function q(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td")(12,"a",10),e.NdJ("click",function(){const a=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.preview(a.id))}),e._uU(13,"Preview"),e.qZA(),e._uU(14," | "),e.TgZ(15,"a",10),e.NdJ("click",function(){const a=e.CHM(t).$implicit,m=e.oxw();return e.KtG(m.delete(a.id))}),e._uU(16,"Delete"),e.qZA()()()}if(2&o){const t=n.$implicit;e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Oqu(t.year),e.xp6(2),e.Oqu(t.actors),e.xp6(2),e.Oqu(t.rate?t.rate+"/ 10":"-")}}const k=[{path:"",component:(()=>{class o{constructor(t,i,s,a){this.moviesService=t,this.dialog=i,this.errorService=s,this.formBuilder=a,this.movies=[],this.pageIndex=1,this.filter=x,this.dialogWidth=Z.Z.MODAL_WIDTH,this.debounceTime=Z.Z.KEY_CHANGES_DELAY,this.filterForm=this.formBuilder.group({title:[this.filter.title],year:[this.filter.year],rate:[this.filter.rate]}),this.keyChangesSubscriptions=[],this._subscribeToControlKeyChanges("title"),this._subscribeToControlKeyChanges("year"),this._subscribeToControlKeyChanges("rate")}ngOnInit(){this._getMovies()}ngOnDestroy(){for(let t of this.keyChangesSubscriptions)t.unsubscribe()}preview(t=0){this.dialog.open(N,{minWidth:this.dialogWidth,data:{movie:this._findMovieById(t)}}).afterClosed().subscribe(()=>{this._getMovies()})}delete(t){this.moviesService.delete(t).subscribe(i=>{this._getMovies()},i=>{this.errorService.handle({friendlyMessage:`Unable to delete selected movie ${t}`,message:i.message,priority:d.p.CRITICAL})})}add(){this.preview()}_subscribeToControlKeyChanges(t){let i=this.filterForm.controls[t].valueChanges.pipe((0,S.b)(this.debounceTime)).subscribe(s=>{this.filter[t]=s,this._getMovies()});this.keyChangesSubscriptions.push(i)}_getMovies(){this.moviesService.getMovies(this.pageIndex,this.filter).subscribe(t=>{this.movies=t},t=>{this.errorService.handle({friendlyMessage:"Unable to get movies, please try again later!",message:t.message,priority:d.p.CRITICAL})})}_findMovieById(t){return this.movies.find(i=>i.id===t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_),e.Y36(h.uw),e.Y36(M.q),e.Y36(r.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-movies"]],decls:32,vars:2,consts:[[1,"header"],["href","","routerLink","/actors","routerLinkActive","is-active"],["href","","routerLink","/movies","routerLinkActive","is-active"],[1,"table-header"],[1,"filters",3,"formGroup"],["type","text","formControlName","title","placeholder","Search"],["type","number","formControlName","year","placeholder","Year"],["type","number","formControlName","rate","placeholder","Rate"],[3,"click"],[4,"ngFor","ngForOf"],[1,"table-link",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"a",1),e._uU(2,"Actors"),e.qZA(),e._uU(3," | "),e.TgZ(4,"a",2),e._uU(5,"Movies"),e.qZA()(),e.TgZ(6,"h3"),e._uU(7,"Yokoy movies"),e.qZA(),e.TgZ(8,"div",3)(9,"form",4),e._UZ(10,"input",5)(11,"input",6)(12,"input",7),e.qZA(),e.TgZ(13,"button",8),e.NdJ("click",function(){return i.add()}),e._uU(14,"Add"),e.qZA()(),e.TgZ(15,"table")(16,"thead")(17,"tr")(18,"td"),e._uU(19,"Id"),e.qZA(),e.TgZ(20,"td"),e._uU(21,"Name"),e.qZA(),e.TgZ(22,"td"),e._uU(23,"Year"),e.qZA(),e.TgZ(24,"td"),e._uU(25,"Actors"),e.qZA(),e.TgZ(26,"td"),e._uU(27,"Rate"),e.qZA(),e.TgZ(28,"td"),e._uU(29,"Actions"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,q,17,5,"tr",9),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("formGroup",i.filterForm),e.xp6(22),e.Q6J("ngForOf",i.movies))},dependencies:[p.sg,v.rH,v.Od,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u]}),o})()}];let J=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(k),v.Bz]}),o})(),Y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[p.ez,J,r.u5,r.UX,h.Is]}),o})()}}]);